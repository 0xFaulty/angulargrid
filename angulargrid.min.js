/*
    angularGrid.js v 0.3.5
    Author: Sudhanshu Yadav
    Copyright (c) 2015 Sudhanshu Yadav - ignitersworld.com , released under the MIT license.
    Demo on: http://ignitersworld.com/lab/angulargrid/demo1.html
    Documentation and download on https://github.com/s-yadav/angulargrid 
*/

!function(n,t,i){"use strict";function a(n){return n.complete&&("undefined"==typeof n.naturalWidth||0!==n.naturalWidth)}function o(n){return Array.prototype.slice.call(n)}var e={gridWidth:300,gutterSize:10,refreshOnImgLoad:!0},r=function(){var i=n.element(t);return function(n){return i[0]=n,i}}();n.element(document.head).append("<style>.ag-no-transition{-webkit-transition: none !important;transition: none !important;} .angular-grid{position : relative;} .angular-grid > *{opacity : 0} .angular-grid > .angular-grid-item{opacity : 1}</style>"),n.module("angularGrid",[]).directive("angularGrid",["$timeout","$window","$q","angularGridInstance",function(t,i,d,u){return{restrict:"A",link:function(s,l,g){function f(){var n=w.offsetWidth,t=Math.floor(n/(z.gridWidth+z.gutterSize)),i=n%(z.gridWidth+z.gutterSize)+z.gutterSize,a=z.gridWidth+Math.floor(i/t);return{no:t,width:a}}function c(t,i){var e=i.beforeLoad||n.noop,r=i.onLoad||n.noop,u=i.isLoaded||n.noop,s=i.onFullLoad||n.noop,l=i.ignoreCheck||n.noop,g=t.find("img"),f=[];o(g).forEach(function(n){e(n),a(n)||l(n)?u(n):f.push(d(function(t,i){n.onload=function(){r(n),t()},n.onerror=i}))}),f.length?d.all(f).then(s,s):setTimeout(function(){s()},0)}function h(){var t,i=f(),a=i.width,e=i.no,d=[];for(t=0;e>t;t++)d.push(0);o(v).forEach(function(t){var i=r(t);o(i.find("img")).forEach(function(t){var o=n.element(t);if(o.hasClass("img-loaded"))return void o.css("height","");i.addClass("ag-no-transition"),i.css("width",a+"px");var e=o.attr("actual-width")||o.attr("data-actual-width"),r=o.attr("actual-height")||o.attr("data-actual-height");e&&r&&o.css("height",r*t.width/e+"px")}),i.removeClass("ag-no-transition")});var u=v.clone();u.addClass("ag-no-transition"),u.css({visibility:"hidden",opacity:0,width:a+"px",top:0,left:0}),l.append(u),c(u,{ignoreCheck:function(n){return!r(n).hasClass("img-loaded")},onFullLoad:function(){var n,t,i,o=[];for(t=0,i=u.length;i>t;t++)o.push(u[t].offsetHeight);for(t=0,i=v.length;i>t;t++){n=r(v[t]);var e=o[t],s=Math.min.apply(Math,d),g=d.indexOf(s);d[g]=s+e+z.gutterSize;var f=g*(a+z.gutterSize);n.css({position:"absolute",top:s+"px",left:f+"px",width:a+"px"}).addClass("angular-grid-item")}l.css("height",Math.max.apply(Math,d)+"px"),u.remove()}})}function m(){var i=!1;o(v).forEach(function(a){var o=n.element(a),e=o.find("img");e.length&&(o.addClass("img-loading"),c(o,{beforeLoad:function(n){r(n).addClass("img-loading")},isLoaded:function(n){r(n).removeClass("img-loading").addClass("img-loaded")},onLoad:function(n){!i&&z.refreshOnImgLoad&&(i=!0,t(function(){h(),i=!1},100)),r(n).removeClass("img-loading").addClass("img-loaded")},onFullLoad:function(){o.removeClass("img-loading").addClass("img-loaded")}}))})}function p(){var n=o(v).filter(function(n){return r(n).hasClass("ng-leave")});return d(function(i){n.length?r(n[0]).one("webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd",function(){t(function(){v=l.children(),i()})}):i()})}var v,C,w=l[0],L=n.element(i),W=g.angularGridId,y=g.angularGrid;l.addClass("angular-grid");var z={gridWidth:g.gridWidth?parseInt(g.gridWidth):e.gridWidth,gutterSize:g.gutterSize?parseInt(g.gutterSize):e.gutterSize,refreshOnImgLoad:"false"==g.refreshOnImgLoad?!1:!0};s.$watch(y,function(){t(function(){v=l.children(),p().then(function(){m(),t(function(){h()})})})},!0);var S=w.offsetWidth;L.on("resize",function(){var n=w.offsetWidth;S!=n&&(S=n,C&&t.cancel(C),C=t(function(){h()},100))}),W&&(u[W]={refresh:function(){t(function(){h()})}})}}}]).factory("angularGridInstance",function(){var n={};return n})}(angular,window);