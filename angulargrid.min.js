/*
    angularGrid.js v 0.3.1
    Author: Sudhanshu Yadav
    Copyright (c) 2015 Sudhanshu Yadav - ignitersworld.com , released under the MIT license.
    Demo on: http://ignitersworld.com/lab/angulargrid/demo1.html
    Documentation and download on https://github.com/s-yadav/angulargrid 
*/

!function(n,t){"use strict";function i(n){return n.complete&&("undefined"==typeof n.naturalWidth||0!==n.naturalWidth)}function a(n){return Array.prototype.slice.call(n)}var e={gridWidth:300,gutterSize:10,refreshOnImgLoad:!0},o=function(){var i=n.element(t);return function(n){return i[0]=n,i}}();n.element(document.head).append("<style>.ag-no-transition{-webkit-transition: none !important;transition: none !important; visibility:hidden; opacity:0;}</style>"),n.module("angularGrid",[]).directive("angularGrid",["$timeout","$window","$q","angularGridInstance",function(t,r,d,u){return{restrict:"A",link:function(l,s,f){function c(){var n=C.offsetWidth,t=Math.floor(n/(z.gridWidth+z.gutterSize)),i=n%(z.gridWidth+z.gutterSize)+z.gutterSize,a=z.gridWidth+Math.floor(i/t);return{no:t,width:a}}function h(t,e){var o=e.beforeLoad||n.noop,r=e.onLoad||n.noop,u=e.isLoaded||n.noop,l=e.onFullLoad||n.noop,s=e.ignoreCheck||n.noop,f=t.find("img"),c=[];a(f).forEach(function(n){o(n),i(n)||s(n)?u(n):c.push(d(function(t,i){n.onload=function(){r(n),t()},n.onerror=i}))}),c.length?d.all(c).then(l,l):l()}function g(){for(var n,t=c(),i=t.width,e=t.no,r=[],n=0;e>n;n++)r.push(0);a(v).forEach(function(n){var t=o(n);a(t.find("img")).forEach(function(n){var a=$(n);if(a.hasClass("img-loaded"))return void a.css("height","");t.css("width",i+"px");var e=a.attr("actual-width")||a.attr("data-actual-width"),o=a.attr("actual-height")||a.attr("data-actual-height");e&&o&&a.css("height",o*n.width/e+"px")})});var d=v.clone();d.addClass("ag-no-transition"),d.css({visibility:"hidden",opacity:0,width:i+"px",top:0,left:0}),s.append(d),h(d,{ignoreCheck:function(n){return!o(n).hasClass("img-loaded")},onFullLoad:function(){var n,t,a,e=[];for(t=0,a=d.length;a>t;t++)e.push(d[t].offsetHeight);for(t=0,a=v.length;a>t;t++){n=o(v[t]);var u=e[t],l=Math.min.apply(Math,r),f=r.indexOf(l);r[f]=l+u+z.gutterSize;var c=f*(i+z.gutterSize);n.css({top:l+"px",left:c+"px",width:i+"px"})}s.css("height",Math.max.apply(Math,r)+"px"),d.remove()}})}function p(){var i=!1;a(v).forEach(function(a){var e=n.element(a),r=e.find("img");r.length&&(e.addClass("img-loading"),h(e,{beforeLoad:function(n){o(n).addClass("img-loading")},isLoaded:function(n){o(n).removeClass("img-loading").addClass("img-loaded")},onLoad:function(n){!i&&z.refreshOnImgLoad&&(i=!0,t(function(){g(),i=!1},100)),o(n).removeClass("img-loading").addClass("img-loaded")},onFullLoad:function(){e.removeClass("img-loading").addClass("img-loaded")}}))})}function m(){var n=a(v).filter(function(n){return o(n).hasClass("ng-leave")});return d(function(i){n.length?o(n[0]).one("webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd",function(){t(function(){v=s.children(),i()})}):i()})}var v,w,C=s[0],L=n.element(r),W=f.angularGridId,y=f.angularGrid,z={gridWidth:f.gridWidth?parseInt(f.gridWidth):e.gridWidth,gutterSize:f.gutterSize?parseInt(f.gutterSize):e.gutterSize,refreshOnImgLoad:"false"==f.refreshOnImgLoad?!1:!0};l.$watch(y,function(){t(function(){v=s.children(),m().then(function(){p(),t(function(){s.addClass("angular-grid"),g()})})})},!0);var S=C.offsetWidth;L.on("resize",function(){var n=C.offsetWidth;S!=n&&(S=n,w&&t.cancel(w),w=t(function(){g()},100))}),W&&(u[W]={refresh:g})}}}]).factory("angularGridInstance",function(){var n={};return n})}(angular,window);